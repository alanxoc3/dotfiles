set -s escape-time 0
set-window-option -g mode-keys vi

unbind C-b
set -g prefix m-t
bind m-t send-prefix

bind P paste-buffer
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle
bind-key -T prefix \` attach-session -c "#{pane_current_path}"
bind-key -T prefix H clear-history

# Saves the current window output into a file and pipes that into kakoune.
bind-key -T prefix K capture-pane -JS - \; run-shell 'TTF=$(mktemp); tmux save-buffer $TTF; tmux delete-buffer; tmux split-window -Z sh -c "kak $TTF; rm $TTF"'
bind-key -T prefix k capture-pane       \; run-shell 'TTF=$(mktemp); tmux save-buffer $TTF; tmux delete-buffer; tmux split-window -Z sh -c "kak $TTF; rm $TTF"'

# For killing things.
bind-key -T prefix x kill-pane
bind-key -T prefix X run-shell 'tmux switch-client -n; tmux kill-session -t "#S"'
bind-key -T prefix S new-session

set -g status-style fg=white,bg=black,dim
set -g status-interval 1
set -g status-left ""

if-shell 'test -z "$SSH_CLIENT"' {
    set -g status-right "#[bold]#(i3b_time)"
} {
    set -g status-right '#[bold]#(echo -e "$(whoami)@$(hostname)")'
}

set -g monitor-activity on
set -g activity-action current
set -g bell-action none
set -g visual-bell off
set-hook -g alert-activity "run-shell 'ttrack rec tmux 5s'"

set -g default-terminal "screen-256color"
set -ga terminal-overrides ",col:Tc"

# This block comes from: https://github.com/tmux-plugins/tmux-sensible
set -g history-limit 50000
set -g display-time 4000
set -g status-keys emacs
set -g focus-events on
setw -g aggressive-resize on
